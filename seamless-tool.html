<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Texture Designer PRO MAX</title>
<style>
body { font-family: sans-serif; background:#111; color:#fff; text-align:center; padding:20px; }
input, button { padding:10px; margin:5px; border-radius:5px; }
button { cursor:pointer; }
img { border:2px solid #4CAF50; max-width:90%; margin-top:10px; }
.map-box { margin:10px; border:2px solid #4CAF50; padding:5px; display:inline-block; }
</style>
</head>
<body>

<h1>Texture Designer PRO MAX</h1>
<input type="file" id="fileInput" accept="image/*"><br>
<input type="text" id="textureName" placeholder="Nom texture (ex: beton_noir)"><br>

<button onclick="autoSeamless()">Auto Seamless</button>
<button onclick="generateAllMaps()">Générer toutes les maps</button>
<button onclick="downloadZIP()">Télécharger ZIP</button>
<button onclick="resetAll()">Reset</button>

<div class="map-box">
<h3>BaseColor</h3>
<canvas id="baseColor"></canvas>
</div>
<div class="map-box">
<h3>Roughness</h3>
<canvas id="roughness"></canvas>
</div>
<div class="map-box">
<h3>Height</h3>
<canvas id="height"></canvas>
</div>
<div class="map-box">
<h3>Normal</h3>
<canvas id="normal"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
let imgData = null;

document.getElementById('fileInput').addEventListener('change', function(e){
    const reader = new FileReader();
    reader.onload = function(event){
        const img = new Image();
        img.onload = function(){
            const canvas = document.getElementById('baseColor');
            canvas.width = img.width; canvas.height = img.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img,0,0);
            imgData = ctx.getImageData(0,0,img.width,img.height);
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
});

function autoSeamless(){
    if(!imgData) return alert("Choisir une image !");
    const canvas = document.getElementById('baseColor');
    const ctx = canvas.getContext('2d');
    const w = canvas.width, h = canvas.height;

    // Créer une nouvelle image pour le seamless
    const tmp = ctx.createImageData(w,h);
    const data = tmp.data;

    // Décalage et inversion des quadrants
    for(let y=0; y<h; y++){
        for(let x=0; x<w; x++){
            const srcX = (x + w/2) % w | 0;
            const srcY = (y + h/2) % h | 0;
            const srcIndex = (srcY*w + srcX)*4;
            const destIndex = (y*w + x)*4;
            for(let i=0;i<4;i++) data[destIndex+i] = imgData.data[srcIndex+i];
        }
    }

    // Appliquer léger flou pour adoucir les bordures
    ctx.putImageData(tmp,0,0);
    ctx.globalAlpha = 0.7;
    for(let offset=-1; offset<=1; offset+=2){
        ctx.drawImage(canvas, offset, 0);
        ctx.drawImage(canvas, 0, offset);
    }
    ctx.globalAlpha = 1;
}

function generateAllMaps(){
    if(!imgData) return alert("Choisir une image !");
    // BaseColor déjà généré
    const w = imgData.width, h = imgData.height;

    // Roughness simple: gris
    const canvasR = document.getElementById('roughness');
    canvasR.width = w; canvasR.height = h;
    const ctxR = canvasR.getContext('2d');
    ctxR.fillStyle="#888"; ctxR.fillRect(0,0,w,h);

    // Height simple: léger bruit
    const canvasH = document.getElementById('height');
    canvasH.width = w; canvasH.height = h;
    const ctxH = canvasH.getContext('2d');
    const imgH = ctxH.createImageData(w,h);
    for(let i=0;i<imgH.data.length;i+=4){
        const val = Math.random()*255|0;
        imgH.data[i]=imgH.data[i+1]=imgH.data[i+2]=val; imgH.data[i+3]=255;
    }
    ctxH.putImageData(imgH,0,0);

    // Normal map simple: bleu
    const canvasN = document.getElementById('normal');
    canvasN.width = w; canvasN.height = h;
    const ctxN = canvasN.getContext('2d');
    ctxN.fillStyle="#77a"; ctxN.fillRect(0,0,w,h);
}

function downloadZIP(){
    const zip = new JSZip();
    const name = document.getElementById('textureName').value || 'texture';
    ['baseColor','roughness','height','normal'].forEach(id=>{
        const canvas = document.getElementById(id);
        canvas.toBlob(blob=>{
            zip.file(`${id}.png`, blob);
            if(id==='normal'){
                zip.generateAsync({type:"blob"}).then(content=>{
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(content);
                    a.download = `${name}.zip`;
                    a.click();
                });
            }
        });
    });
}

function resetAll(){
    ['baseColor','roughness','height','normal'].forEach(id=>{
        const canvas = document.getElementById(id);
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0,0,canvas.width,canvas.height);
    });
    imgData=null;
}
</script>
</body>
  </html>
