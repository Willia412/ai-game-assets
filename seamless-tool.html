<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Texture Designer PRO MAX</title>
<style>
body { font-family: Arial; background: #111; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px;}
input, button { padding: 10px; margin: 5px; border-radius: 8px; border: none;}
button { cursor: pointer; }
#maps { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px;}
.map-box { border: 2px solid #2ecc71; padding: 5px; text-align: center; }
.map-box canvas { max-width: 150px; max-height: 150px; display: block; margin: auto;}
</style>
</head>
<body>

<h2>Texture Designer PRO MAX</h2>
<input type="file" id="fileInput" accept="image/*"><br>
<input type="text" id="textureName" placeholder="Nom texture (ex: beton_noir)"><br>
<button id="autoSeamless">Auto Seamless</button>
<button id="generateMaps">Générer toutes les maps</button>
<button id="downloadZip">Télécharger ZIP</button>
<button id="reset">Reset</button>

<div id="maps">
  <div class="map-box"><strong>BaseColor</strong><canvas id="baseColor"></canvas></div>
  <div class="map-box"><strong>Roughness</strong><canvas id="roughness"></canvas></div>
  <div class="map-box"><strong>Height</strong><canvas id="height"></canvas></div>
  <div class="map-box"><strong>Normal</strong><canvas id="normal"></canvas></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
let img = new Image();
let canvasBase = document.getElementById('baseColor');
let ctxBase = canvasBase.getContext('2d');

document.getElementById('fileInput').addEventListener('change', function(e){
  let file = e.target.files[0];
  let reader = new FileReader();
  reader.onload = function(ev){
    img.src = ev.target.result;
    img.onload = function(){
      canvasBase.width = img.width;
      canvasBase.height = img.height;
      ctxBase.drawImage(img,0,0);
    }
  }
  reader.readAsDataURL(file);
});

function makeSeamless(context){
  let w = context.canvas.width;
  let h = context.canvas.height;
  let temp = document.createElement('canvas');
  temp.width = w;
  temp.height = h;
  let tctx = temp.getContext('2d');
  // Décalage 50% horizontal et vertical
  tctx.drawImage(context.canvas, w/2, h/2, w/2, h/2, 0,0, w/2, h/2);
  tctx.drawImage(context.canvas, 0, h/2, w/2, h/2, w/2,0,w/2,h/2);
  tctx.drawImage(context.canvas, w/2,0,w/2,h/2,0,h/2,w/2,h/2);
  tctx.drawImage(context.canvas,0,0,w/2,h/2,w/2,h/2,w/2,h/2);
  context.clearRect(0,0,w,h);
  context.drawImage(temp,0,0);
}

document.getElementById('autoSeamless').addEventListener('click', function(){
  makeSeamless(ctxBase);
});

function generateMaps(){
  let width = canvasBase.width;
  let height = canvasBase.height;

  let canvases = {
    roughness: document.getElementById('roughness'),
    height: document.getElementById('height'),
    normal: document.getElementById('normal')
  };

  for(let key in canvases){
    canvases[key].width = width;
    canvases[key].height = height;
  }

  let baseData = ctxBase.getImageData(0,0,width,height);
  let roughCtx = canvases.roughness.getContext('2d');
  let heightCtx = canvases.height.getContext('2d');
  let normalCtx = canvases.normal.getContext('2d');

  let rough = roughCtx.createImageData(width,height);
  let heightMap = heightCtx.createImageData(width,height);
  let normalMap = normalCtx.createImageData(width,height);

  for(let i=0;i<baseData.data.length;i+=4){
    let r = baseData.data[i];
    let g = baseData.data[i+1];
    let b = baseData.data[i+2];
    let gray = 0.299*r + 0.587*g + 0.114*b;
    // Roughness : inversé du gris
    rough.data[i] = rough.data[i+1] = rough.data[i+2] = 255 - gray;
    rough.data[i+3] = 255;
    // Height : gris
    heightMap.data[i] = heightMap.data[i+1] = heightMap.data[i+2] = gray;
    heightMap.data[i+3] = 255;
    // Normal (simple approximation)
    let nx = (r/255)*2-1;
    let ny = (g/255)*2-1;
    normalMap.data[i] = (nx*0.5+0.5)*255;
    normalMap.data[i+1] = (ny*0.5+0.5)*255;
    normalMap.data[i+2] = 255;
    normalMap.data[i+3] = 255;
  }

  roughCtx.putImageData(rough,0,0);
  heightCtx.putImageData(heightMap,0,0);
  normalCtx.putImageData(normalMap,0,0);
}

document.getElementById('generateMaps').addEventListener('click', generateMaps);

// Reset
document.getElementById('reset').addEventListener('click', function(){
  ctxBase.clearRect(0,0,canvasBase.width,canvasBase.height);
  ['roughness','height','normal'].forEach(id=>{
    let c = document.getElementById(id);
    c.getContext('2d').clearRect(0,0,c.width,c.height);
  });
});

</script>
</body>
  </html>
